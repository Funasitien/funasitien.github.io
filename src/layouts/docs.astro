---
import Sidebar from "../components/docs/Sidebar.astro";
import { ClientRouter } from 'astro:transitions';
import "@fontsource/poppins";
import "@fontsource/poppins/800.css";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import "../assets/app.css";
import remarkToc from 'remark-toc'

const {
  title = "Funasitien",
  description = "Funasitien's super dupper website is amazing!",
  toc,
  showAllSidebar = false
} = Astro.props;

// Extract current category from URL path
const currentPath = Astro.url.pathname;
const currentCategory = currentPath.split('/')[1] || '';
---
<html lang="fr" data-theme="superlight" class="selection:bg-sky-200 selection:text-sky-700 transition-all duration-500 ease-in-out">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/png+xml" href="/logo.png" />
    <link rel="stylesheet" type="text/css" href="/font/font.css" />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <title>{title}</title>
    <meta content={title} property="og:title" />
    <meta content={description} property="og:description" />
    <meta content="https://f.dreamclouds.fr" property="og:url" />
    <meta content="https://f.dreamclouds.fr/logo.png" property="og:image" />
    <meta content="#43B581" data-react-helmet="true" name="theme-color" />
    <script is:inline>
      // Prevent FART effect
      if (localStorage.getItem("theme") === null) {
        document.documentElement.setAttribute("data-theme", "superlight");
      } else {
        document.documentElement.setAttribute(
          "data-theme",
          localStorage.getItem("theme")
        );
      }
    </script>
    <script>
      import { themeChange } from "theme-change";
      themeChange();
    </script>
    <ClientRouter />
  </head>
  <style>
    body {
      font-family: "Poppins", "FluentEmoji", sans-serif;
      transition: all 0.25s cubic-bezier(0.427, 0.073, 0.105, 0.997) 0.1s;
    }
  </style>
  <body>
    <Header />
    <div class="drawer lg:drawer-open">
      <input id="my-drawer" type="checkbox" class="drawer-toggle" />
      <div class="drawer-content min-h-screen">
        <label for="my-drawer" class="btn btn-primary drawer-button lg:hidden fixed top-4 left-4 z-50">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
          </svg>
        </label>
        
        <main class="flex-grow px-4 py-32 prose max-w-full w-full">
          <slot />
        </main>

        <aside class="table-of-contents">
          {toc && toc.length > 0 ? (
            <nav>
              <ul>
                {toc.map((heading) => (
                  <li style="margin-left: {heading.depth * 1.5}rem;">
                    <a href={`#${heading.slug}`}>{heading.text}</a>
                  </li>
                ))}
              </ul>
            </nav>
          ) : (
            <p>No table of contents available.</p>
          )}
        </aside>
        
        <Footer />
      </div>
      
      <div class="drawer-side z-40">
        <label for="my-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
        <div class="bg-base-200 min-h-full w-80">
          <Sidebar 
            currentSlug={currentPath} 
            currentCategory={!showAllSidebar ? currentCategory : undefined} 
          />
        </div>
      </div>
    </div>
  </body>
</html>